<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RCS - Remote Control System</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Consolas&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="login-overlay">
      <div class="login-card">
        <h2 class="mb-4 fw-bold text-primary">
          <i class="fas fa-shield-alt"></i> RCS Login
        </h2>
        <div class="mb-3 text-start">
          <label class="form-label small fw-bold">Server IP</label>
          <input type="text" id="server-ip" class="form-control mb-2" placeholder="Ex: 192.168.1.5" value="localhost" />
          <div class="row">
            <div class="col-6">
              <label class="form-label small fw-bold">Port</label>
              <input type="number" id="server-port" class="form-control mb-2" value="8181" />
            </div>
            <div class="col-6">
              <label class="form-label small fw-bold">Password</label>
              <input type="password" id="auth-pass" class="form-control mb-2" value="123" />
            </div>
          </div>
        </div>
        <button onclick="initiateConnection()" class="btn btn-primary w-100 fw-bold py-2">
          CONNECT SYSTEM
        </button>
        <p id="login-error" class="mt-3 text-danger fw-bold small"></p>
      </div>
    </div>

    <div class="d-flex disabled-ui" id="main-interface">
      <div id="sidebar-wrapper">
        <div class="sidebar-heading">
          <i class="fas fa-network-wired"></i> SYSTEM CORE
        </div>
        <div class="list-group list-group-flush mt-3">
          <a href="#" class="list-group-item active" onclick="switchTab('dashboard', this)">
            <i class="fas fa-chart-line"></i> Dashboard
          </a>
          <a href="#" class="list-group-item" onclick="switchTab('monitor', this)">
            <i class="fas fa-desktop"></i> Screen Monitor
          </a>
          <a href="#" class="list-group-item" onclick="switchTab('webcam', this)">
            <i class="fas fa-camera"></i> Webcam Control
          </a>
          <a href="#" class="list-group-item" onclick="switchTab('processes', this)">
            <i class="fas fa-tasks"></i> Process & Apps
          </a>
          <a href="#" class="list-group-item" onclick="switchTab('terminal', this)">
            <i class="fas fa-terminal"></i> Terminal Logs
          </a>
          <a href="#" class="list-group-item text-danger mt-auto mb-4" onclick="disconnect()">
            <i class="fas fa-sign-out-alt"></i> Disconnect
          </a>
        </div>
      </div>

      <div id="page-content-wrapper">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="fw-bold text-dark m-0" id="pageTitle">Overview</h3>
          <span id="connectionBadge" class="status-badge status-offline">
            <i class="fas fa-circle"></i> Disconnected
          </span>
        </div>

        <div id="tab-dashboard" class="tab-content active">
          <div class="row">
            <div class="col-md-6">
              <div class="card-custom">
                <div class="card-header-custom">
                  <i class="fas fa-power-off text-danger"></i> Power Control
                </div>
                <div class="d-grid gap-2">
                  <button onclick="if(confirm('Tắt máy server?')) sendCommand('SHUTDOWN')" class="btn btn-danger">
                    <i class="fas fa-power-off"></i> SHUTDOWN SERVER
                  </button>
                  <button onclick="if(confirm('Khởi động lại server?')) sendCommand('RESTART')" class="btn btn-warning text-dark">
                    <i class="fas fa-sync"></i> RESTART SERVER
                  </button>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card-custom">
                <div class="card-header-custom">
                  <i class="fas fa-rocket text-primary"></i> Quick Launch
                </div>
                <div class="input-group mb-3">
                  <input type="text" id="quickAppInput" class="form-control" placeholder="Tên app (vd: notepad, calc)" onkeydown="if(event.key === 'Enter') startApp()" />
                  <button onclick="startApp()" class="btn btn-primary"><i class="fas fa-play"></i> Run</button>
                  <button onclick="browseApps()" class="btn btn-warning text-dark fw-bold"><i class="fas fa-th-large"></i> Library</button>
                </div>
                <label class="small fw-bold text-secondary mb-2">Web Browser Shortcuts:</label>
                <div class="d-flex gap-2 justify-content-between">
                  <button onclick="openWeb('https://facebook.com')" class="btn btn-outline-primary flex-fill"><i class="fab fa-facebook-f"></i> FB</button>
                  <button onclick="openWeb('https://youtube.com')" class="btn btn-outline-danger flex-fill"><i class="fab fa-youtube"></i> YT</button>
                  <button onclick="openWeb('https://gmail.com')" class="btn btn-outline-danger flex-fill"><i class="fas fa-envelope"></i> Mail</button>
                  <button onclick="openWeb('https://google.com')" class="btn btn-outline-success flex-fill"><i class="fab fa-google"></i> Web</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="tab-monitor" class="tab-content">
          <div class="row">
            <div class="col-lg-8">
              <div class="card-custom h-100">
                <div class="card-header-custom">
                  <span><i class="fas fa-video text-danger"></i> Live Stream</span>
                  <div>
                    <button onclick="sendCommand('START_STREAM')" class="btn btn-success btn-sm"><i class="fas fa-play"></i> Start</button>
                    <button onclick="sendCommand('STOP_STREAM')" class="btn btn-secondary btn-sm"><i class="fas fa-stop"></i> Stop</button>
                  </div>
                </div>
                <div class="monitor-frame" style="min-height: 400px">
                  <div id="screen-placeholder" class="text-secondary text-center">
                    <i class="fas fa-satellite-dish fa-3x mb-3"></i><br />Stream Offline
                  </div>
                  <img id="live-screen" src="" alt="Live Stream" style="width: 100%; height: auto" />
                  <div class="monitor-overlay-text" id="monitorStatus">Ready</div>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="card-custom h-100">
                <div class="card-header-custom"><span><i class="fas fa-camera text-primary"></i> Snapshot</span></div>
                <div class="text-center">
                  <p class="small text-secondary mb-3">Chụp ảnh màn hình chất lượng cao.</p>
                  <button onclick="sendCommand('CAPTURE_SCREEN')" class="btn btn-primary w-100 py-2 fw-bold mb-3 shadow-sm">
                    <i class="fas fa-camera fa-lg me-2"></i> CHỤP NGAY
                  </button>
                  <hr class="my-3 opacity-25" />
                  <h6 class="fw-bold text-start small text-muted"><i class="fas fa-history"></i> Ảnh vừa chụp:</h6>
                  <div id="preview-container" class="border rounded p-2 bg-light mt-2" style="min-height: 150px; display: flex; align-items: center; justify-content: center;">
                    <span class="text-muted small fst-italic" id="preview-text">Chưa có ảnh nào</span>
                    <img id="captured-preview" class="img-fluid rounded shadow-sm hidden" onclick="viewFullImage(this)" style="cursor: zoom-in" />
                  </div>
                  <div class="mt-2 text-end">
                    <span class="badge bg-success hidden" id="save-badge"><i class="fas fa-check"></i> Saved on Server</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="tab-webcam" class="tab-content">
          <div class="card-custom">
            <div class="card-header-custom">
              <span><i class="fas fa-eye text-danger"></i> Webcam Surveillance</span>
              <span id="cam-status" class="badge bg-secondary">OFFLINE</span>
            </div>
            <div class="row p-3">
              <div class="col-md-8 text-center">
                <div style="background: #000; min-height: 400px; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                  <img id="webcam-feed" src="" style="width: 100%; height: 100%; object-fit: contain; display: none;" />
                  <div id="webcam-placeholder" class="text-white-50"><i class="fas fa-video-slash fa-3x mb-3"></i><br />Webcam is Off</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="bg-light p-3 rounded border">
                  <h5 class="fw-bold mb-3"><i class="fas fa-sliders-h"></i> Controls</h5>
                  <button onclick="sendCommand('START_WEBCAM')" class="btn btn-success w-100 mb-2 fw-bold"><i class="fas fa-power-off"></i> BẬT WEBCAM</button>
                  <button onclick="sendCommand('STOP_WEBCAM')" class="btn btn-secondary w-100 mb-4"><i class="fas fa-stop-circle"></i> TẮT</button>
                  <hr />
                  <h5 class="fw-bold mb-3 text-danger"><i class="fas fa-circle"></i> Recording</h5>
                  <div class="mb-3">
                    <label class="form-label small fw-bold">Thời lượng (giây):</label>
                    <input type="number" id="record-duration" class="form-control" value="10" min="5" max="60" />
                  </div>
                  <button onclick="startRecordWebcam()" class="btn btn-danger w-100 fw-bold"><i class="fas fa-record-vinyl"></i> GHI HÌNH & LƯU</button>
                  <small class="text-muted d-block mt-2 fst-italic" style="font-size: 0.8rem">* Video lưu tại <b>WebcamRecordings</b> trên Server.</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="tab-processes" class="tab-content">
          <div class="card-custom">
            <div class="card-header-custom">
              <span><i class="fas fa-list-alt text-primary"></i> Task Manager</span>
              <div>
                <button onclick="getApps()" class="btn btn-outline-primary btn-sm">Apps Only</button>
                <button onclick="getProcesses()" class="btn btn-outline-secondary btn-sm">All Processes</button>
              </div>
            </div>
            <div style="max-height: 500px; overflow-y: auto">
              <table class="table table-hover table-custom" id="procTable">
                <thead>
                  <tr><th>ID</th><th>Name / Title</th><th>Memory</th><th>Action</th></tr>
                </thead>
                <tbody>
                  <tr><td colspan="4" class="text-center">No data. Click refresh buttons above.</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="tab-terminal" class="tab-content">
          <div class="row h-100 g-3">
            <div class="col-md-3">
              <div class="card-custom h-100 d-flex flex-column">
                <div class="card-header-custom small-header">
                  <span><i class="fas fa-history"></i> System Log</span>
                  <button onclick="document.getElementById('terminal-output').innerText = ''" class="btn btn-sm btn-light border">Clear</button>
                </div>
                <div id="terminal-output" class="terminal-window flex-grow-1 system-log-font">> Ready...</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card-custom h-100 d-flex flex-column">
                <div class="card-header-custom small-header">
                  <span class="text-danger"><i class="fas fa-microchip"></i> Raw Input</span>
                  <button onclick="document.getElementById('raw-key-output').innerHTML = ''" class="btn btn-sm btn-light border">Clear</button>
                </div>
                <div id="raw-key-output" class="terminal-window flex-grow-1 raw-log-area"></div>
              </div>
            </div>
            <div class="col-md-5">
              <div class="card-custom h-100 d-flex flex-column">
                <div class="card-header-custom small-header d-flex justify-content-between align-items-center">
                  <span class="text-success"><i class="fas fa-file-word"></i> Document View</span>
                  <button onclick="downloadLog()" class="btn btn-sm btn-success text-white fw-bold"><i class="fas fa-download"></i> Tải .txt</button>
                </div>
                <div class="paper-container flex-grow-1">
                  <textarea id="keylogger-editor" class="paper-textarea" readonly placeholder="Waiting for text..."></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="app-library-modal" class="modal-overlay hidden">
      <div class="modal-content-custom">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="fw-bold m-0"><i class="fas fa-rocket text-primary"></i> App Library</h4>
          <button onclick="closeAppLibrary()" class="btn btn-close"></button>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text"><i class="fas fa-search"></i></span>
          <input type="text" id="appSearch" class="form-control" placeholder="Tìm ứng dụng..." onkeyup="filterApps()" />
        </div>
        <div id="app-grid" class="app-grid-container">
          <div class="text-center p-4 text-secondary"><i class="fas fa-spinner fa-spin me-2"></i> Đang tải danh sách...</div>
        </div>
      </div>
    </div>

    <div id="toast-container" class="toast-container"></div>
    
    <script type="module" src="js/main.js"></script>
  </body>
</html>